name: Lint Golang && Terraform
on:
  workflow_call:
jobs:
  lint_golang:
    name: Lint Golang
    runs-on: ubuntu-latest
    steps:
      - name: Setup Golang
        uses: actions/setup-go@v3
        with:
          go-version: 1.17

      - name: Checkout code
        uses: actions/checkout@v3

      - name: Lint Glang 
        uses: golangci/golangci-lint-action@v3
        with:
          version: v1.29

  lint_terraform:
    name: Lint Terraform
    runs-on: ubuntu-latest
    steps:
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v2

      - name: Checkout code
        uses: actions/checkout@v3

      - name: Initialize Terraform (dev)
        run: make tf-init-nb env=dev

      - name: Lint Terraform (dev) 
        run: make tf-val-check env=dev 

      - name: Initialize Terraform (uat)
        run: make tf-init-nb env=uat

      - name: Lint Terraform (uat) 
        run: make tf-val-check env=uat 

      - name: Initialize Terraform (prd)
        run: make tf-init-nb env=prd

      - name: Lint Terraform (prd) 
        run: make tf-val-check env=prd 
